\apendice{Documentación técnica de programación}

\section{Introducción}

En este anexo se explica todo lo que tiene que conocer el programador tanto para instalar y ejecutar la aplicación como para poder seguir con el desarrollo.

\section{Estructura de directorios}

\section{Manual del programador}

\section{Instalación y ejecución del proyecto}

\subsection{Instalación}

\subsubsection{MongoDB}

Antes de empezar con la instalación de la aplicación tenemos que instalar la base de datos.
Se ha utilizado una base de datos no relacional MongoDB.

Concretamente se instaló la versión \textit{3.6.4 Community Server} \cite{misc:mongodb} para windows.

También se ha utilizado \textit{MongoDB Compass} \cite{misc:mongodb} para visualizar el contenido de la base de datos. Esta herramienta es opcional.

\subsubsection{Python}

Esta aplicación se ha desarrollado utilizando la version 3.6.4 \cite{misc:python3}, por lo que se recomienda utilizar esta versión o una posterior. En cualquier caso debe de instalarse Python 3 o superior para evitar incompatibilidades.

Todos los paquetes utilizados en la aplicación están listados en en ficheros requirements.txt junto con sus correspondientes versiones.

Habrá que instalar todas las dependencias utilizando pip\footnote{Gestor de paquetes de Python \cite{misc:pip}}:

\begin{lstlisting}
pip install -r requirements.txt
\end{lstlisting}

\subsection{Ejecución}

\subsubsection{Actualización de la base de datos}

Antes de ejecutar la aplicación tendremos que construir la base de datos con el contenido de todas nuestras fuentes por primera vez.

Para ello simplemente hay que ejecutar el fichero \textit{actualiza-fuentes.py}. Puede tardar un rato debido a la gran cantidad de datos que se van a cargar.

Este paso puede repetirse cada vez que se quiera actualizar las fuentes de datos. Puede ser utilizar ejecutarlo una vez al mes para mantener al día las fuentes con datos mensuales.

\begin{lstlisting}
python actualiza-fuentes.py
\end{lstlisting}

\subsubsection{Servidor web}

El servidor Flask ya se ha instalado como un paquete, por lo que no necesita más instalación.
Para ejecutarlo hay un script \textit{run.py} que nos lanza el servidor en el puerto 5000.

Una vez lanzado podremos acceder a la página web desde \href{http://localhost:5000}{localhost:5000}.

\begin{lstlisting}
python run.py
\end{lstlisting}

\section{Despliegue}

Para desplegar la aplicación se ha obtado utilizar como servidor en la nube DigitalOcean y Nanobox como microservicio para facilitarnos la instalación de la máquina en la nube y la configuración del servidor.

\subsection{Instalación}

\subsubsection{Digital Ocean}

Primero tendremos que registrarnos en \href{https://www.digitalocean.com/}{DigitalOcean} y obtener el token de nuestro usuario. Tendremos que poner una tarjeta de crédito de la que nos cobrarán el importe del servidor.

Podría utilizarse otro proveedor de hosting como \textit{Amazon Web services} o \textit{Google Compute}.

\subsubsection{Nanobox}

Después nos registraremos en \href{https://nanobox.io/}{Nanobox} y creamos una nueva aplicación utilizando el token que hemos obtenido antes en DigitalOcean.

Ahora elegiremos el plan que queramos contratar. Para este proyecto será suficiente con el plan más basico de 5\$, 1 CPU y 1GB de ram.

Tras crear la aplicación instalamos el \href{https://docs.nanobox.io/install/}{cliente de nanobox}. La primera vez que lancemos un comando nos pedirá los datos para iniciar sesión en nuestra cuenta.

En el fichero \textit{nanobox.yml} tenemos la configuración con los componentes que se van a instalar y los comandos que se ejecutan al desplegar la aplicación.

\subsection{Despliegue}


Una vez todo instalado y configurado, cada vez que queramos actualizar la aplicación del servidor nos situamos en la carpeta del proyecto y lanzamos el siguiente comando:

\begin{lstlisting}
nanobox deploy
\end{lstlisting}

Con esto, de forma transparente para nosotros, se crea una máquina virtual con nuestro proyecto en la que se instalan la base de datos, el entorno de ejecución y los paquetes y se ejecuta la aplicación en el servidor.

\section{Pruebas del sistema}
